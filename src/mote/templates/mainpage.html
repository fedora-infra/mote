<!doctype html>
<!--
##########################################################################
*
*   Copyright Â© 2019-2021 Akashdeep Dhar <t0xic0der@fedoraproject.org>
*
*   This program is free software: you can redistribute it and/or modify
*   it under the terms of the GNU General Public License as published by
*   the Free Software Foundation, either version 3 of the License, or
*   (at your option) any later version.
*
*   This program is distributed in the hope that it will be useful,
*   but WITHOUT ANY WARRANTY; without even the implied warranty of
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*   GNU General Public License for more details.
*
*   You should have received a copy of the GNU General Public License
*   along with this program.  If not, see <https://www.gnu.org/licenses/>.
*
##########################################################################
-->
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link href="{{ url_for('static', filename='css3/bootstrap.min.css') }}" rel="stylesheet"/>
        <link href="{{ url_for('static', filename='css3/custom_fonts.css') }}" rel="stylesheet"/>
        <link href="{{ url_for('static', filename='css3/fragment.css') }}" rel="stylesheet"/>
        <link href="{{ url_for('static', filename='css3/fontawesome-all.min.css') }}" rel="stylesheet"/>
        <script src="{{ url_for('static', filename='jscn/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ url_for('static', filename='jscn/jquery.min.js') }}"></script>
        <link rel="icon" href="{{ url_for('static', filename='imgs/logoteal.png') }}" sizes="16x16">
        <script src="{{ url_for('static', filename='jscn/fragment.js') }}"></script>
        <script src="{{ url_for('static', filename='jscn/easy.qrcode.min.js') }}"></script>
        <script src="{{ url_for('static', filename='jscn/socket.io.js') }}"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.js"></script>
        <title>Meetbot Logs</title>
    </head>
    <body class="body bg-light">
        <nav class="navbar sticky-top navbar-expand-lg navbar-light p-1" style="background-image: linear-gradient(180deg,#eee 0,#ddd);">
            <div class="container-fluid"> 
                <a class="navbar-brand" href="#">
                    <img class="logo" alt="MEETBOT LOGS" src="{{ url_for('static', filename='imgs/Fedora_logo.png') }}" style="width: 100%; height: auto;" width="200" height="40" />
                </a>
                <button class="navbar-toggler"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent"
                        aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" type="button">
                                Recent meetings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" data-bs-toggle="modal" data-bs-target="#chanmode" type="button" onclick="populate_channel_list();">
                                Meetings by Channel
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" type="button" href="#">
                                Meetings by Group
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" type="button" href="#">
                                About
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container-lg">
            <div class="card text-center" style="margin-top: 0%;">
                <div id="loader"></div>
                <div class="card-body">
                    <div class="text-center">
                        <div class="mt-4">
                            <div id='calendar'></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center" style="background-color: #e6e6e6; color:  #676767;">
                    <span class="small">
                        <a style="color:#676767; text-decoration:none;"
                           href="https://github.com/t0xic0der/fragment/"
                           target="_blank">
                            Fragment

                        </a>
                        &copy 2021

                        <a style="color:#676767; text-decoration:none;"
                           href="https://github.com/t0xic0der"
                           target="_blank">
                            Akashdeep Dhar
                        </a>
                        and
                        <a style="color:#676767; text-decoration:none;"
                           href="https://github.com/t0xic0der/fragment/graphs/contributors"
                           target="_blank">
                            others
                        </a>
                    </span>
                </div>
            </div>
        </div>
        <div class="modal fade"
             aria-hidden="true"
             data-bs-backdrop="static"
             data-bs-keyboard="true"
             id="findmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2" style="background-image: linear-gradient(180deg,#eee 0,#ddd);  color:#51A2DA;" >
                        <h6 class="modal-title head fw-bold">Lookup discussions</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="input-group mb-3">
                                <input type="text"
                                       class="form-control"
                                       placeholder="Search for your meetings"
                                       aria-label="Search for your meetings"
                                       aria-describedby="findtext"
                                       id="findtext">
                                <button class="btn btn-outline-secondary"
                                        type="button"
                                        id="findbutn"
                                        onclick="search_meetings();">
                                    Search
                                </button>
                            </div>
                            <div class="card mb-3 mt-3" id="find-body"></div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center text-white p-1" style="background-image: linear-gradient(180deg,#eee 0,#ddd);">
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true" id="chanmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2" style="background-image: linear-gradient(180deg,#eee 0,#ddd); color:#51A2DA;">
                        <h6 class="modal-title head fw-bold">Explore meetings</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="chanhead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <div class="card">
                                <ul class="list-group list-group-flush" id="listchan-uols"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between p-1" style="background-image: linear-gradient(180deg,#eee 0,#ddd);">
                        <div class="float-left">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0 disabled"
                                    id="chanback">
                                Back
                            </button>
                        </div>
                        <span class="small fst-italic" id="chanfoot">
                            <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
                        </span>
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true" id="datemode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2" style="background-image: linear-gradient(180deg,#eee 0,#ddd); color:#51A2DA;"> 
                        <h6 class="modal-title head fw-bold">Explore meetings</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="datehead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <div class="card">
                                <ul class="list-group list-group-flush" id="listdate-uols"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between p-1" style="background-image: linear-gradient(180deg,#eee 0,#ddd);">
                        <div class="float-left">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    id="dateback"
                                    data-bs-toggle="modal"
                                    data-bs-dismiss="modal"
                                    data-bs-target="#chanmode">
                                Back
                            </button>
                        </div>
                        <span class="small fst-italic" id="datefoot">
                            <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
                        </span>
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade"
             aria-hidden="true"
             data-bs-backdrop="static"
             data-bs-keyboard="true"
             id="meetmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2" style="background-image: linear-gradient(180deg,#eee 0,#ddd); color:#51A2DA;">
                        <h6 class="modal-title head fw-bold">Explore meetings</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="meethead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <div class="card">
                                <ul class="list-group list-group-flush" id="listmeet-uols"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between p-1" style="background-image: linear-gradient(180deg,#eee 0,#ddd);">
                        <div class="float-left">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    id="meetback"
                                    data-bs-toggle="modal"
                                    data-bs-dismiss="modal"
                                    data-bs-target="#datemode">
                                Back
                            </button>
                        </div>
                        <span class="small fst-italic" id="meetfoot">
                            <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
                        </span>
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade"
             aria-hidden="true"
             data-bs-backdrop="static"
             data-bs-keyboard="true"
             id="rcntmode">
            <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-lg-down modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header justify-content-center p-2" style="background-image: linear-gradient(180deg,#eee 0,#ddd); color:#51A2DA;">
                        <h6 class="modal-title head fw-bold">Recent conversations</h6>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="card mb-3">
                                <div class="list-group-item bg-light">
                                    <span id="rcnthead" class="fw-bold">Loading...</span>
                                </div>
                            </div>
                            <nav>
                                <div class="nav justify-content-center nav-tabs" role="tablist">
                                    <button class="nav-link active"
                                            id="daya-head"
                                            data-bs-toggle="tab"
                                            data-bs-target="#daya-cont"
                                            type="button"
                                            role="tab"
                                            aria-controls="data-cont"
                                            aria-selected="false">
                                        <span>Last day</span>
                                    </button>
                                    <button class="nav-link"
                                            id="week-head"
                                            data-bs-toggle="tab"
                                            data-bs-target="#week-cont"
                                            type="button"
                                            role="tab"
                                            aria-controls="week-cont"
                                            aria-selected="true">
                                        <span>Last week</span>
                                    </button>
                                </div>
                            </nav>
                            <div class="tab-content mt-3">
                                <div class="tab-pane fade show active"
                                     id="daya-cont"
                                     role="tabpanel"
                                     aria-labelledby="daya-head">
                                    <ul class="list-group" id="listrcnt-daya-uols"></ul>
                                    <div id="none-daya"></div>
                                </div>
                                <div class="tab-pane fade"
                                     id="week-cont"
                                     role="tabpanel"
                                     aria-labelledby="week-head">
                                    <ul class="list-group" id="listrcnt-week-uols"></ul>
                                    <div id="none-week"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center text-white p-1" style="background-image: linear-gradient(180deg,#eee 0,#ddd);">
                        <div class="float-right">
                            <button type="button"
                                    class="btn btn-sm btn-light m-0"
                                    data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toast-container position-fixed bottom-0 end-0 p-3"> 
        </div>
    </body>
    <script>

        var socket = io.connect();
        function meetingEnded(msg){
            var meet_dt = new Date(msg['details']['time_'] * 1000);
            var toastDiv = $(`
                <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <strong class="me-auto">
                            Meeting <a href="`+ msg['url'] +`.html" style="font-style: italic;" target="_blank">`+ msg['meeting_topic'] +`</a> has ended
                        </strong>
                        <small>`+ meet_dt.toLocaleTimeString() +`</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
                `);
            var parentDiv = $('.toast-container');
            $(parentDiv).append(toastDiv);
            var toast = new bootstrap.Toast(toastDiv, {autohide: false});
            toast.show();
        }
        socket.on("show_toast", function (msg) {
            meetingEnded(msg);
        });
        var allEvents=[]

        async function getMonthlyMeetings(){
            const d = new Date();
            let day = d.getDate();
            await $.getJSON("/fragedpt/", {
                "rqstdata": "clndrmtgs",
                "numdays": day
            }, function (data) {
                for (var name in data) {
                    var dictionary={}
                    dictionary.title=data[name].topic
                    dictionary.start=new Date(data[name].time).toISOString().slice(0, 10);
                    dictionary.url=data[name].slug.summary
                    allEvents.push(dictionary)
                }
            });
        }

        document.addEventListener('DOMContentLoaded', async function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          headerToolbar: { center: 'dayGridMonth,dayGridWeek' }
        });
        calendar.render();
        document.getElementById("loader").innerHTML = `
        <span class="spinner-border spinner-border-sm mt-2" role="status" aria-hidden="true"></span>
        `;
        await getMonthlyMeetings()
        document.getElementById("loader").innerHTML = "";
        for(var i=0;i<allEvents.length;i++){
            calendar.addEvent(allEvents[i]) 
        }
      });


    </script>
</html>